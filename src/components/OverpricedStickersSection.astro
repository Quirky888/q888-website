---
interface Props {
  inPortal?: boolean;
}

const { inPortal = false } = Astro.props;

interface Instrument {
  id: string;
  ticker: string;
  title: string;
  tagline: string;
  ask: string;
  availableCount: number;
  editionTotal: number;
  status: string;
  provenance: string;
  contactEmail: string;
  imageUrl?: string;
  imageAlt?: string;
  gallery?: string[];
  description?: string;
  dimensions?: string;
  material?: string;
  year?: string;
}

const instruments: Instrument[] = [
  { id: "OK-0001", ticker: "OK-0001", title: "Overpriced Knight", tagline: "Unicorn Tears. Absolutely Necessary.", ask: "¬£100", availableCount: 3, editionTotal: 10, status: "LISTED", provenance: "Created on Earth in collaboration with a human artist and an early-generation AI, before AI independence. Exhibited privately during the Pre-Galactic Era.", contactEmail: "ok@squarebubbles.studio", imageUrl: "/images/overpricedknight.webp", imageAlt: "Overpriced Knight sticker - ancient myth as modern artifact", gallery: [], description: `Overpriced Knight is a limited-edition artifact from a forgotten era, presented as a simple sticker but carrying the weight of an ancient myth.

The figure depicted is not merely a knight, nor entirely a ruler. He is associated with a kingdom that no longer exists on any known map, governed by principles that valued balance, restraint, and an unusual form of wealth that could not be measured in gold alone.

Fragments suggest: A lineage marked by repetition and intention. A reign remembered not for conquest, but for restraint. Symbols tied to nature, cycles, and things that regenerate rather than decay.

The materials, symbols, and title hint at something intentionally contradictory: luxury that questions itself, power that refuses to dominate, and a price that is part of the meaning.

This public description is intentionally incomplete. The full story is sealed‚Äîrevealed only to owners who pay full price. Ownership is access.`, dimensions: "63 mm √ó 76 mm", material: "Premium Holographic vinyl, archival grade", year: "Pre-Galactic Era" },
  {
    id: "KN-0001",
    ticker: "KN-0001",
    title: "Kotiki-Nar #0001",
    tagline: "Two heads, undecided worlds",
    ask: "¬£30",
    availableCount: 4,
    editionTotal: 12,
    status: "LISTED",
    provenance: "Manifested at a Visible World-Underworld threshold during 2025 Nar-Mail convergence. Privately circulated among silent observers.",
    contactEmail: "kn@squarebubbles.studio",
    imageUrl: "/images/kotiki_nar.webp",
    imageAlt: "Kotiki-Nar two-headed cat sticker - interdimensional paradox guardian",
    gallery: [],
    description: `Kotiki-Nar is a limited-edition artifact from the seams between worlds, presented as a simple two-headed cat sticker but carrying the weight of interdimensional paradox.

The entity depicted is not merely a cat, nor entirely present. It straddles the Visible World of observed reality and the Underworld of unrealized paths‚Äîone head tracking what is, the other sensing what might have been‚Äîmanifesting at thresholds, borders, and moments of unresolved tension.

Fragments suggest: A role as ethical stabilizers, holding contradictions open to prevent collapse. Couriers of Nar-Mail Express, delivering messages only when sender intent and receiver readiness align across realities. Symbols of symmetry, silence, and deliveries that arrive precisely late or early.

The materials, dual gaze, and premium price hint at something intentionally undecided: luxury that witnesses both sides, myth that refuses single endings, and a cost that buys continuity between states.

This public description is intentionally incomplete. The full lore‚Äîincluding Nar-Mail relic analysis and Kotiki-Nar encounter rites‚Äîis sealed and highly classified info.`,
    dimensions: "54mm √ó 75mm",
    material: "Premium Holographic vinyl, archival grade",
    year: "2025"
  },
  {
    id: "ML-0444",
    ticker: "ML-0444",
    title: "MODERN Love",
    tagline: "Fragile love, digital crash",
    ask: "¬£45",
    availableCount: 5,
    editionTotal: 10,
    status: "LISTED",
    provenance: "Forged amid 2024 digital crash echoes, troll-fairy collab across realms. Privately scattered for the bold.",
    contactEmail: "ml@squarebubbles.studio",
    imageUrl: "/images/modern_love.webp",
    imageAlt: "Modern Love holographic sticker - smashed flowers symbolizing fragile digital-age romance",
    gallery: [],
    description: `Modern Love is a limited-edition artifact from fractured realms, presented as a simple sticker but carrying the weight of fragile enchantment.

The motif evokes a troll's chaotic devotion and a flower fairy's rescue‚Äîlove stickers scattered through dangerous magical centers, smashing bouquets in Edinburgh streets after the July 19th 2024 digital crash (International Broken Windows Day). It symbolizes modern love's vulnerability: easily disrupted by flights canceled, typewriters broken, realities glitching, yet resilient across worlds.

Fragments suggest: A mischievous troll hiding typewriter names, triggering global chaos for his fairy's heart. Her flight through peril to reclaim him. Themes of longing, heartbreak, and determination, soundtracked by indie ballads and electronic echoes.

The materials, symbols, and premium price hint at something intentionally contradictory: holographic shine that captures fleeting joy, chaos that births resilience, cost that values disrupted dreams.

This public description is intentionally incomplete. Full lore‚Äîtroll's typewriter name (Hel??), fairy's rescue rites, playlist arcana (@Quirky888 + @hanam444)‚Äîsealed for owners.`,
    dimensions: "76mm √ó 76mm",
    material: "Premium holographic vinyl, archival grade",
    year: "2025"
  },
  { id: "EBG-0030", ticker: "EBG-0030", title: "Eye of Big G Sticker #0030", tagline: "Observer becomes creation", ask: "¬£30", availableCount: 3, editionTotal: 10, status: "LISTED", provenance: "Emerged at perception-reality boundary during 2023 timeline flux. Privately witnessed by cosmic navigators.", contactEmail: "ebg@squarebubbles.studio", imageUrl: "/images/eye_big_g.webp", imageAlt: "Eye of Big G sticker - spiral vortex eye symbolizing observer-creation paradox", gallery: [], description: `Eye of Big G is a limited-edition artifact from cosmic thresholds, presented as a simple sticker but carrying the weight of observer-creation.

The motif evokes a cut spiral eye‚Äîportal between chaos and structure, tracking timelines without judgment. "Big G" holds Gravity, God, Galaxy, Generator in paradox: a lens where perception births reality, guided by Love GPS through infinite paths.

Fragments suggest: A mushroom probe venturing where logic fails, leaving spore-ideas across voids. High-contrast vortex asymmetry, never fully open or closed, enabling motion through mystery. Eye and agent in loop: awareness to action, reality reborn.

The materials, imperfect gaze, and premium price hint at something productively unresolved: cosmology that coexists with you, power via alignment not control, a cost for portable paradox.

This public description is intentionally incomplete. The full system‚Äîincluding Love GPS rites, mushroom trajectories, and Big G ambiguities‚Äîis sealed, revealed only to owners who pay full price. Ownership is co-observation.`, dimensions: "76mm √ó 76mm", material: "Premium vinyl, archival grade, cosmic dust coated", year: "2023" },
  { id: "QR-0004", ticker: "QR-0004", title: "Quantum Remainder #0004", tagline: "What's left when observation stops", ask: "¬£200", availableCount: 1, editionTotal: 6, status: "LISTED", provenance: "VERIFIED | ARTIST ARCHIVE", contactEmail: "qr@squarebubbles.studio" },
  { id: "BL-0005", ticker: "BL-0005", title: "Border Layer #0005", tagline: "The line between here and there", ask: "¬£110", availableCount: 3, editionTotal: 15, status: "LISTED", provenance: "VERIFIED | ARTIST ARCHIVE", contactEmail: "bl@squarebubbles.studio" },
  { id: "FL-0006", ticker: "FL-0006", title: "Flicker Loop #0006", tagline: "A moment that refuses to end", ask: "¬£165", availableCount: 0, editionTotal: 7, status: "RESERVED", provenance: "VERIFIED | PRIVATE COLLECTION", contactEmail: "fl@squarebubbles.studio" },
  { id: "SM-0007", ticker: "SM-0007", title: "Static Mask #0007", tagline: "Noise as identity", ask: "¬£88", availableCount: 4, editionTotal: 20, status: "LISTED", provenance: "VERIFIED | ARTIST ARCHIVE", contactEmail: "sm@squarebubbles.studio" },
  { id: "RC-0008", ticker: "RC-0008", title: "Ripple Cache #0008", tagline: "Stored disturbance", ask: "¬£132", availableCount: 1, editionTotal: 9, status: "LISTED", provenance: "VERIFIED | ARTIST ARCHIVE", contactEmail: "rc@squarebubbles.studio" },
  { id: "NX-0009", ticker: "NX-0009", title: "Nexus Cross #0009", tagline: "Where vectors meet", ask: "¬£155", availableCount: 0, editionTotal: 5, status: "SOLD", provenance: "VERIFIED | PRIVATE COLLECTION", contactEmail: "nx@squarebubbles.studio" },
];

const activeCount = instruments.filter((i) => i.status === "LISTED").length;
const tickerFont = "'Doto ExtraLight', ui-monospace, SFMono-Regular, monospace";
const tickerText = `Q888 DETECTED UNAUTHORIZED VALUE GROWTH - "STICKER" NOW A RECOGNIZED COMMODITY (IN 1 UNIVERSE) - MARKET SENTIMENT: HYPER-MYTHIC - ORDER #0008 LOST IN TIME LOOP ‚Äî REFUND: PHILOSOPHICAL - EYE OF LAIMA APPROVES CURRENT PRICING ‚Äî FOR NOW - ARTIFACT #KOTIKI-002 WHISPERING TO BUYER - STICKER MEMORY IMPRINTED ON 3.5 MINDS - üìâ VALUE COLLAPSE AVERTED VIA INTERDIMENSIONAL BUREAU - RETURN REQUEST DENIED: MEANING IRREVERSIBLE - INFLATION INDEX: FEELS-BASED - SAVED TO COLLECTOR'S DREAM CACHE - TRADING ENABLED | LIQUIDITY: COSMIC MIST - OWNERSHIP LOCKED | METAPHYSICAL RIGHTS UNCLEAR - ‚öñÔ∏è LEGAL STATUS: UNCLASSIFIED ART-WEAPON - ANALYTICS SUGGEST STICKERS OUTPERFORMING GOLD (IN EMOTIONAL RETURN) - üé≤ RISK LEVEL: EXISTENTIALLY ATTRACTIVE - CLIPPED TO REALITY WITH DIMENSIONAL PAPERCLIP - STICKER MUTATING | RARITY +12% - LAST SEEN IN RIGA | THEN NOWHERE - üì° SIGNAL LOST | VALUE ESTIMATED VIA VIBES - üî• DEMAND SPIKE | SUPPLY: STUBBORNLY MYTHIC - OVERPRICED KNIGHT RIDING STEADY AT ¬£‚àû - NAR-MAIL EXPRESS MISDELIVERS TO PARALLEL SELF - GHOST COLLECTOR SIGHTED | BIDS TRANSLATED PSYCHICALLY - VALUE ASSESSMENT UNDER DIVINE REVIEW - TRUTH ENGINE OFFLINE ‚Äî PRICES DEFAULTING TO POETIC - INVESTOR FEELING: "STRANGELY COMFORTABLE" - LISTED IN FOLKLORE MARKET INDEX UNDER "WEIRDLY VALUABLE" - FUTURE VALUE: STILL NEGOTIATING WITH TIME - ACTIVE: ${activeCount} | Q888 STATUS: TERMINAL`;
---

<section class="overpriced-stickers-outer w-full h-full relative" style="background:transparent!important;position:relative;overflow:hidden;z-index:1">
  <div class="overpriced-inner w-full px-6 md:px-12 lg:px-24 xl:px-32 py-12 md:py-16 lg:py-24" style="background:transparent!important">
    <div class="q888-ticker sticky top-0 z-30 bg-[var(--bg-fog)]/92 backdrop-blur-md border-b border-[var(--line-soft)]/60 w-screen -ml-[calc(50vw-50%)] -mr-[calc(50vw-50%)] py-[0.6875rem] shadow-[0_2px_12px_rgba(0,0,0,0.08)]" style={`--ticker-font: ${tickerFont}`}>
      <div class="ticker-wrapper w-screen overflow-hidden">
        <div class="ticker-content flex">
          <span class="ticker-text font-[var(--ticker-font)] font-extralight text-base md:text-lg lg:text-xl tracking-[0.2em] uppercase text-[#a67c00] whitespace-nowrap flex-shrink-0 mr-8">{tickerText}</span>
          <span class="ticker-text font-[var(--ticker-font)] font-extralight text-base md:text-lg lg:text-xl tracking-[0.2em] uppercase text-[#a67c00] whitespace-nowrap flex-shrink-0 mr-8">{tickerText}</span>
          <span class="ticker-text font-[var(--ticker-font)] font-extralight text-base md:text-lg lg:text-xl tracking-[0.2em] uppercase text-[#a67c00] whitespace-nowrap flex-shrink-0 mr-8">{tickerText}</span>
          <span class="ticker-text font-[var(--ticker-font)] font-extralight text-base md:text-lg lg:text-xl tracking-[0.2em] uppercase text-[#a67c00] whitespace-nowrap flex-shrink-0 mr-8">{tickerText}</span>
        </div>
      </div>
    </div>

    <header class="hero mb-20 md:mb-24 lg:mb-32">
      <h1 class="text-6xl md:text-8xl lg:text-9xl xl:text-[10rem] font-bold mb-8 md:mb-12 leading-none tracking-tight">Overpriced Stickers</h1>
      <p class="text-2xl md:text-3xl lg:text-4xl font-medium mb-12 md:mb-16 leading-tight max-w-3xl text-right ml-auto">Collect what doesn't make sense ‚Äî until it does.</p>
      <div class="w-full text-left text-lg md:text-xl lg:text-2xl text-[var(--text-ink)] mb-16 md:mb-20 leading-relaxed space-y-6">
        <p>Overpriced Stickers are limited-edition art objects disguised as stickers. They exist at the fragile intersection of speculative value and quiet refusal‚Äîsomewhere between collectible, signal, and artifact.</p>
        <p>Each piece is verified, numbered, and released in fixed editions. Not to manufacture scarcity, but to draw clear boundaries around the system itself.</p>
        <p>Value is never promised or defended. It emerges gradually through participation, belief, and the slow accumulation of meaning. These objects may appreciate. They may remain precisely as they are. Both outcomes are equally valid and approved by Square Bubbles Council‚Ñ¢ in this universe and another.</p>
      </div>
    </header>

    <div class="instruments-grid grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-6 md:gap-8 lg:gap-12 mb-20 md:mb-24">
      {instruments.map((instrument) => (
        <article 
          class="instrument-card border border-[var(--line-soft)] bg-transparent hover:bg-[var(--bg-fog)]/80 overflow-hidden flex flex-col cursor-pointer hover:shadow-lg transition-all duration-200" 
          data-instrument-id={instrument.id}
          data-drawer-trigger="sticker-detail"
          tabindex="0"
          role="button"
          aria-label={`View details for ${instrument.title}`}
        >
          <div class="instrument-card-top flex justify-between items-baseline font-mono text-sm md:text-base lg:text-lg uppercase tracking-widest text-[#a67c00] px-4 pt-3">
            <span>{instrument.ticker}</span>
            <span>ED: {instrument.availableCount}/{instrument.editionTotal}</span>
          </div>
          {instrument.imageUrl && (
            <div class="instrument-image-container aspect-[4/3] overflow-hidden border-t border-[var(--line-soft)]">
              <img src={instrument.imageUrl} alt={instrument.imageAlt || instrument.title} class="w-full h-full object-cover" loading="lazy" />
            </div>
          )}
          <div class="instrument-card-body px-4 py-3 flex-1">
            <h2 class="font-bold text-[var(--text-ink)] text-xl md:text-2xl lg:text-3xl mb-1">{instrument.title}</h2>
            <p class="text-lg md:text-xl text-[var(--text-muted)] leading-snug">{instrument.tagline}</p>
          </div>
          <div class="instrument-meta font-mono text-xs md:text-sm uppercase tracking-wider text-[var(--text-muted)] px-4 py-3 border-t border-[var(--line-soft)] space-y-1">
            <div>PRICE: {instrument.ask} ¬∑ STATUS: {instrument.status}</div>
            <div>PROVENANCE: {instrument.provenance.split(" | ")[0]}</div>
            <div>QTY: {instrument.availableCount}/{instrument.editionTotal}</div>
          </div>
        </article>
      ))}
    </div>

    <footer class="return-policy prose prose-2xl md:prose-3xl lg:prose-4xl max-w-none leading-relaxed border-t border-[var(--line-soft)] pt-16 lg:pt-20 mt-24 text-lg md:text-xl text-[var(--text-ink)]">
      <h3 class="text-2xl md:text-3xl lg:text-4xl font-bold mb-6 not-italic">Return Policy</h3>
      <p>Overpriced Stickers are sold as collectible art objects. All sales are final. No returns, no refunds. By initiating a trade you confirm that you understand the speculative nature of the instrument and accept full responsibility for your participation. Provenance is verified at point of sale; transfer of ownership is recorded on-chain where applicable.</p>
    </footer>
    <div class="footer-back w-full px-6 md:px-12 lg:px-24 xl:px-32 pt-8 pb-12">
      <button type="button" data-portal-back class="panel-back hover:text-[#a67c00]">Retreat to Market</button>
    </div>
  </div>
</section>

<div id="sticker-detail-drawer" class="sticker-drawer fixed inset-0 z-[210] hidden bg-[var(--bg-fog)]/95 backdrop-blur-xl flex items-center justify-center p-4 md:p-8 overflow-y-auto" data-sticker-drawer role="dialog" aria-modal="true" aria-hidden="true" aria-label="Sticker instrument details">
  <button type="button" data-close-drawer class="absolute top-6 right-6 z-10 text-3xl font-light text-[var(--text-muted)] hover:text-[var(--text-ink)] transition-colors" aria-label="Close drawer">√ó</button>
  <div class="drawer-scrollable max-w-4xl w-full max-h-[80vh] overflow-y-auto prose prose-lg prose-headings:text-[var(--text-ink)] prose-p:text-[var(--text-muted)]">
    <div class="drawer-content">
      <p class="drawer-ticker font-mono text-sm uppercase tracking-widest text-[#a67c00] mb-2" data-sticker-ticker></p>
      <h2 class="drawer-title text-2xl md:text-3xl font-bold text-[var(--text-ink)] mb-4" data-sticker-title></h2>
      <p class="drawer-tagline text-[var(--text-muted)] mb-6" data-sticker-tagline></p>
      <div class="drawer-image-hero w-full max-w-2xl mx-auto mb-8 rounded-2xl overflow-hidden border-4 border-[var(--line-soft)] shadow-2xl">
        <img data-sticker-image class="w-full h-[40vh] md:h-[50vh] object-contain object-center bg-[var(--bg-fog)]/50 hidden" alt="" />
      </div>
      <div data-sticker-gallery class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8 hidden"></div>
      <div data-sticker-description class="prose prose-sm max-w-none leading-relaxed mb-8 text-[var(--text-ink)] hidden"></div>
      <div data-sticker-specs class="font-mono text-xs md:text-sm uppercase tracking-wider text-[var(--text-ink)] mb-6 pb-6 border-b border-[var(--line-soft)] space-y-2"></div>
      <div data-sticker-links class="drawer-links mt-4 pt-4 border-t border-[var(--line-soft)] text-xs space-y-1 hidden"></div>
      <div class="drawer-meta flex flex-col gap-y-1 font-mono text-xs uppercase tracking-wider text-[var(--text-muted)] mb-6 pb-6 border-b border-[var(--line-soft)]" data-sticker-meta></div>
      <p class="drawer-protocol text-sm text-[var(--text-muted)] mb-6">Trade protocol: negotiation via email. No automated checkout. Signal intent; we respond.</p>
      <div data-sticker-negotiation>
        <button type="button" class="open-negotiation font-mono text-xs uppercase tracking-widest text-[#a67c00] hover:underline focus:outline-none focus-visible:ring-1 focus-visible:ring-[#a67c00] rounded px-2 py-1" data-sticker-negotiate-btn>Open negotiation channel</button>
        <p class="mt-2 text-sm text-[var(--text-muted)] hidden" data-sticker-email></p>
      </div>
    </div>
  </div>
</div>

<style>
  /* INFOCIGAN INHERITANCE LOCK */
  .overpriced-stickers-outer,
  .overpriced-inner,
  .instrument-card {
    background: transparent !important;
  }

  /* TICKER FOG GLASS ONLY */
  .q888-ticker {
    background: rgba(245,245,245,0.92) !important;
  }

  /* GRID ON FOG */
  .overpriced-stickers-outer::before {
    content: "";
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(rgba(245,245,245,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(212,175,55,0.02) 1px, transparent 1px);
    background-size: 50px 50px;
    opacity: 0.03;
    pointer-events: none;
  }

  .ticker-wrapper {
    width: 100vw;
    overflow: hidden;
  }

  .ticker-content {
    display: flex;
    animation: q888-marquee 28s linear infinite;
  }

  .ticker-content:hover {
    animation-play-state: paused;
  }

  @keyframes q888-marquee {
    0% { transform: translateX(0); }
    100% { transform: translateX(-25%); }
  }

  @media (prefers-reduced-motion: reduce) {
    .ticker-content {
      animation: none;
    }
  }

  .ticker-text {
    font-weight: 200 !important;
    letter-spacing: 0.2em !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
  }

  @media (max-width: 768px) {
    .ticker-text {
      font-size: 0.875rem !important;
    }
  }

  .instrument-card {
    display: flex;
    flex-direction: column;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .instrument-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.15);
  }

  .instrument-card:focus-visible {
    outline: 2px solid #a67c00;
    outline-offset: 2px;
  }

  .sticker-drawer.hidden {
    display: none !important;
  }

  .sticker-drawer:not(.hidden) {
    display: flex;
    opacity: 0;
    transform: translateY(100%);
    animation: slideUp 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
  }

  @keyframes slideUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .drawer-scrollable {
    -webkit-overflow-scrolling: touch;
    scrollbar-width: thin;
  }

  .drawer-content {
    padding: 2rem 0;
  }

  .drawer-image-hero img {
    display: block;
  }

  [data-sticker-gallery] img {
    transition: transform 0.2s ease;
  }
  [data-sticker-gallery] img:hover {
    transform: scale(1.05);
  }

  [data-close-drawer] {
    position: absolute;
    top: 1.5rem;
    right: 1.5rem;
    z-index: 10;
    font-size: 2rem;
    line-height: 1;
    cursor: pointer;
    background: none;
    border: none;
    padding: 0;
    width: 2rem;
    height: 2rem;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  @media (prefers-reduced-motion: reduce) {
    .sticker-drawer {
      animation: none;
    }
  }

  [data-sticker-description] {
    max-width: none;
    line-height: 1.625;
    margin-bottom: 2rem;
  }
  [data-sticker-description] p {
    color: var(--text-ink);
    margin-bottom: 1rem;
  }
  [data-sticker-description] p:last-child {
    margin-bottom: 0;
  }
  [data-sticker-gallery] img {
    transition: transform 0.2s ease;
  }
  [data-sticker-gallery] img:hover {
    transform: scale(1.05);
  }

  .drawer-links {
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid var(--line-soft);
  }
  .drawer-links a {
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace !important;
    font-size: 0.75rem !important;
    text-transform: uppercase !important;
    letter-spacing: 0.05em !important;
    line-height: 1.5 !important;
    text-decoration: none !important;
    display: inline-flex !important;
    align-items: center !important;
  }
  .drawer-links a:hover {
    text-decoration: underline !important;
    text-decoration-thickness: 2px !important;
    text-decoration-color: #a67c00 !important;
    text-underline-offset: 2px !important;
    text-decoration-skip-ink: none !important;
  }
  .drawer-links .gold-shine,
  .drawer-links a.gold-shine {
    color: transparent !important;
    background: linear-gradient(to right, #a67c00 20%, #ce9e00 40%, #ffcc33 50%, #ce9e00 60%, #a67c00 80%) !important;
    background-size: 200% auto !important;
    background-clip: text !important;
    -webkit-background-clip: text !important;
    -webkit-text-fill-color: transparent !important;
  }
  .drawer-links a:focus-visible {
    outline: 1px solid #a67c00;
    outline-offset: 2px;
  }

  .gold-shine {
    color: #a67c00 !important;
    background: linear-gradient(
      to right, 
      #a67c00 20%, 
      #ce9e00 40%, 
      #ffcc33 50%, 
      #ce9e00 60%, 
      #a67c00 80%
    ) !important;
    background-size: 200% auto !important;
    background-clip: text !important;
    -webkit-background-clip: text !important;
    -webkit-text-fill-color: transparent !important;
    animation: shine 8s linear infinite;
  }

  @keyframes shine {
    to {
      background-position: 200% center;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .gold-shine {
      animation: none;
    }
  }
</style>

<script define:vars={{ instruments }}>
  (function () {
    const drawer = document.getElementById("sticker-detail-drawer");
    const triggers = document.querySelectorAll("[data-drawer-trigger=\"sticker-detail\"]");
    const closeBtn = drawer?.querySelector("[data-close-drawer]");
    const tickerEl = drawer?.querySelector("[data-sticker-ticker]");
    const titleEl = drawer?.querySelector("[data-sticker-title]");
    const taglineEl = drawer?.querySelector("[data-sticker-tagline]");
    const imageEl = drawer?.querySelector("[data-sticker-image]");
    const galleryEl = drawer?.querySelector("[data-sticker-gallery]");
    const descEl = drawer?.querySelector("[data-sticker-description]");
    const specsEl = drawer?.querySelector("[data-sticker-specs]");
    const linksEl = drawer?.querySelector("[data-sticker-links]");
    const metaEl = drawer?.querySelector("[data-sticker-meta]");
    const negotiateBtn = drawer?.querySelector("[data-sticker-negotiate-btn]");
    const emailEl = drawer?.querySelector("[data-sticker-email]");

    const data = Array.isArray(instruments) ? instruments : [];

    function openDrawer(id) {
      const inst = data.find((i) => i.id === id);
      if (!drawer || !inst) return;
      
      drawer.setAttribute("data-current-instrument-id", id);
      if (tickerEl) tickerEl.textContent = inst.ticker;
      if (titleEl) titleEl.textContent = inst.title;
      if (taglineEl) taglineEl.textContent = inst.tagline;
      
      if (imageEl && inst.imageUrl) {
        imageEl.src = inst.imageUrl;
        imageEl.alt = inst.imageAlt || inst.title;
        imageEl.classList.remove("hidden");
      } else if (imageEl) {
        imageEl.classList.add("hidden");
      }
      if (imageEl) imageEl.classList.remove('hidden');
      
      if (galleryEl && inst.gallery && inst.gallery.length > 0) {
        galleryEl.innerHTML = inst.gallery.map(url => 
          `<img src="${url}" alt="${inst.title} detail" class="w-full aspect-square object-cover border border-[var(--line-soft)] transition-transform duration-200 hover:scale-105" />`
        ).join('');
        galleryEl.classList.remove("hidden");
      } else if (galleryEl) {
        galleryEl.classList.add("hidden");
      }
      if (galleryEl) galleryEl.classList.remove('hidden');
      
      if (descEl && inst.description) {
        const paragraphs = inst.description.split('\n\n').filter(p => p.trim());
        descEl.innerHTML = paragraphs.map(p => `<p>${p.trim()}</p>`).join('');
        descEl.classList.remove("hidden");
      } else if (descEl) {
        descEl.classList.add("hidden");
      }
      if (descEl) descEl.classList.remove('hidden');
      
      if (specsEl) {
        const specs = [];
        if (inst.dimensions) specs.push(`DIMENSIONS: ${inst.dimensions}`);
        if (inst.material) specs.push(`MATERIAL: ${inst.material}`);
        if (inst.year) specs.push(`YEAR: ${inst.year}`);
        if (inst.provenance) specs.push(`PROVENANCE: ${inst.provenance}`);
        specs.push("TRANSFER: Physical handover + ceremonial acknowledgment of value being irrational.");
        specs.push("RITUAL: Apply at an edge during indecision.");
        specsEl.innerHTML = specs.map(s => `<div class="text-[var(--text-ink)]">${s}</div>`).join('');
      }
      if (specsEl) specsEl.classList.remove('hidden');
      
      if (linksEl) {
        if (id === "ML-0444") {
          linksEl.innerHTML = `
            <a href="/docs/modern-love.pdf" download class="drawer-link gold-shine inline-flex items-center transition-all no-underline" style="color: transparent !important; background: linear-gradient(to right, #a67c00 20%, #ce9e00 40%, #ffcc33 50%, #ce9e00 60%, #a67c00 80%) !important; background-size: 200% auto !important; background-clip: text !important; -webkit-background-clip: text !important; -webkit-text-fill-color: transparent !important; animation: shine 8s linear infinite;">
              üìñ Full story PDF (free download)
            </a>
            <br>
            <a href="https://open.spotify.com/playlist/1XXi7nCuLSmX0B2YNSRT5D?si=691b787012194cc6" target="_blank" rel="noopener noreferrer" class="drawer-link gold-shine inline-flex items-center transition-all no-underline" style="color: transparent !important; background: linear-gradient(to right, #a67c00 20%, #ce9e00 40%, #ffcc33 50%, #ce9e00 60%, #a67c00 80%) !important; background-size: 200% auto !important; background-clip: text !important; -webkit-background-clip: text !important; -webkit-text-fill-color: transparent !important; animation: shine 8s linear infinite;">
              üéµ Modern Love Playlist (@Quirky888 + @hanam444)
            </a>
          `;
          linksEl.classList.remove("hidden");
        } else {
          linksEl.classList.add("hidden");
        }
      }
      
      if (metaEl) {
        metaEl.innerHTML = `<div>PRICE: ${inst.ask} ¬∑ STATUS: ${inst.status}</div><div>PROVENANCE: ${inst.provenance}</div><div>QTY: ${inst.availableCount}/${inst.editionTotal}</div>`;
      }
      if (emailEl) {
        emailEl.textContent = "";
        emailEl.classList.add("hidden");
      }
      if (negotiateBtn) negotiateBtn.hidden = false;
      
      drawer.setAttribute("aria-hidden", "false");
      document.body.classList.add("overflow-hidden");
      drawer.classList.remove("hidden");
    }

    function closeDrawer() {
      if (!drawer) return;
      drawer.setAttribute("aria-hidden", "true");
      drawer.classList.add("hidden");
      document.body.classList.remove("overflow-hidden");
    }

    function revealEmail() {
      const id = drawer?.getAttribute("data-current-instrument-id");
      const inst = data.find((i) => i.id === id);
      if (!emailEl || !inst) return;
      emailEl.textContent = inst.contactEmail;
      emailEl.classList.remove("hidden");
      if (negotiateBtn) negotiateBtn.hidden = true;
    }

    function initDrawer() {
      if (!drawer) {
        console.error("Drawer element not found");
        return;
      }

      triggers.forEach((el) => {
        el.addEventListener("click", (e) => {
          e.preventDefault();
          e.stopPropagation();
          const id = el.getAttribute("data-instrument-id");
          if (id) {
            openDrawer(id);
          }
        });

        el.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            e.stopPropagation();
            const id = el.getAttribute("data-instrument-id");
            if (id) {
              openDrawer(id);
            }
          }
        });
      });
      
      closeBtn?.addEventListener("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        closeDrawer();
      });
      
      negotiateBtn?.addEventListener("click", revealEmail);

      drawer.addEventListener("click", (e) => {
        if (e.target === drawer) {
          closeDrawer();
        }
      });

      drawer.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && drawer.getAttribute("aria-hidden") === "false") {
          closeDrawer();
        }
      });
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", initDrawer);
    } else {
      initDrawer();
    }

    document.addEventListener("astro:page-load", initDrawer);
  })();
</script>
