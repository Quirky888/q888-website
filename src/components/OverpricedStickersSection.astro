---
interface Props {
  inPortal?: boolean;
}

const { inPortal = false } = Astro.props;

interface Instrument {
  id: string;
  ticker: string;
  title: string;
  tagline: string;
  ask: string;
  availableCount: number;
  editionTotal: number;
  status: string;
  provenance: string;
  contactEmail: string;
}

const instruments: Instrument[] = [
  { id: "OK-0001", ticker: "OK-0001", title: "OK Sticker #0001", tagline: "The first signal of quiet rebellion", ask: "¬£120", availableCount: 1, editionTotal: 10, status: "LISTED", provenance: "VERIFIED | ARTIST ARCHIVE", contactEmail: "ok@squarebubbles.studio" },
  { id: "PG-0001", ticker: "PG-0001", title: "Portal Gate Sticker #0001", tagline: "Unlocks hidden coordinates", ask: "¬£180", availableCount: 0, editionTotal: 5, status: "RESERVED", provenance: "VERIFIED | PRIVATE COLLECTION", contactEmail: "pg@squarebubbles.studio" },
  { id: "DS-0002", ticker: "DS-0002", title: "Dust Signal #0002", tagline: "Echoes from the edge", ask: "¬£95", availableCount: 2, editionTotal: 12, status: "LISTED", provenance: "VERIFIED | ARTIST ARCHIVE", contactEmail: "ds@squarebubbles.studio" },
  { id: "VN-0003", ticker: "VN-0003", title: "Void Note #0003", tagline: "Silence made visible", ask: "¬£140", availableCount: 0, editionTotal: 8, status: "SOLD", provenance: "VERIFIED | PRIVATE COLLECTION", contactEmail: "vn@squarebubbles.studio" },
  { id: "QR-0004", ticker: "QR-0004", title: "Quantum Remainder #0004", tagline: "What's left when observation stops", ask: "¬£200", availableCount: 1, editionTotal: 6, status: "LISTED", provenance: "VERIFIED | ARTIST ARCHIVE", contactEmail: "qr@squarebubbles.studio" },
  { id: "BL-0005", ticker: "BL-0005", title: "Border Layer #0005", tagline: "The line between here and there", ask: "¬£110", availableCount: 3, editionTotal: 15, status: "LISTED", provenance: "VERIFIED | ARTIST ARCHIVE", contactEmail: "bl@squarebubbles.studio" },
  { id: "FL-0006", ticker: "FL-0006", title: "Flicker Loop #0006", tagline: "A moment that refuses to end", ask: "¬£165", availableCount: 0, editionTotal: 7, status: "RESERVED", provenance: "VERIFIED | PRIVATE COLLECTION", contactEmail: "fl@squarebubbles.studio" },
  { id: "SM-0007", ticker: "SM-0007", title: "Static Mask #0007", tagline: "Noise as identity", ask: "¬£88", availableCount: 4, editionTotal: 20, status: "LISTED", provenance: "VERIFIED | ARTIST ARCHIVE", contactEmail: "sm@squarebubbles.studio" },
  { id: "RC-0008", ticker: "RC-0008", title: "Ripple Cache #0008", tagline: "Stored disturbance", ask: "¬£132", availableCount: 1, editionTotal: 9, status: "LISTED", provenance: "VERIFIED | ARTIST ARCHIVE", contactEmail: "rc@squarebubbles.studio" },
  { id: "NX-0009", ticker: "NX-0009", title: "Nexus Cross #0009", tagline: "Where vectors meet", ask: "¬£155", availableCount: 0, editionTotal: 5, status: "SOLD", provenance: "VERIFIED | PRIVATE COLLECTION", contactEmail: "nx@squarebubbles.studio" },
];

const activeCount = instruments.filter((i) => i.status === "LISTED").length;
const tickerFont = "'Doto ExtraLight', ui-monospace, SFMono-Regular, monospace";
const tickerText = `Q888 DETECTED UNAUTHORIZED VALUE GROWTH - "STICKER" NOW A RECOGNIZED COMMODITY (IN 1 UNIVERSE) - MARKET SENTIMENT: HYPER-MYTHIC - ORDER #0008 LOST IN TIME LOOP ‚Äî REFUND: PHILOSOPHICAL - EYE OF LAIMA APPROVES CURRENT PRICING ‚Äî FOR NOW - ARTIFACT #KOTIKI-002 WHISPERING TO BUYER - STICKER MEMORY IMPRINTED ON 3.5 MINDS - üìâ VALUE COLLAPSE AVERTED VIA INTERDIMENSIONAL BUREAU - RETURN REQUEST DENIED: MEANING IRREVERSIBLE - INFLATION INDEX: FEELS-BASED - SAVED TO COLLECTOR'S DREAM CACHE - TRADING ENABLED | LIQUIDITY: COSMIC MIST - OWNERSHIP LOCKED | METAPHYSICAL RIGHTS UNCLEAR - ‚öñÔ∏è LEGAL STATUS: UNCLASSIFIED ART-WEAPON - ANALYTICS SUGGEST STICKERS OUTPERFORMING GOLD (IN EMOTIONAL RETURN) - üé≤ RISK LEVEL: EXISTENTIALLY ATTRACTIVE - CLIPPED TO REALITY WITH DIMENSIONAL PAPERCLIP - STICKER MUTATING | RARITY +12% - LAST SEEN IN RIGA | THEN NOWHERE - üì° SIGNAL LOST | VALUE ESTIMATED VIA VIBES - üî• DEMAND SPIKE | SUPPLY: STUBBORNLY MYTHIC - OVERPRICED KNIGHT RIDING STEADY AT ¬£‚àû - NAR-MAIL EXPRESS MISDELIVERS TO PARALLEL SELF - GHOST COLLECTOR SIGHTED | BIDS TRANSLATED PSYCHICALLY - VALUE ASSESSMENT UNDER DIVINE REVIEW - TRUTH ENGINE OFFLINE ‚Äî PRICES DEFAULTING TO POETIC - INVESTOR FEELING: "STRANGELY COMFORTABLE" - LISTED IN FOLKLORE MARKET INDEX UNDER "WEIRDLY VALUABLE" - FUTURE VALUE: STILL NEGOTIATING WITH TIME - ACTIVE: ${activeCount} | Q888 STATUS: TERMINAL`;
---

<section class="overpriced-stickers-outer w-full h-full relative" style="background:transparent!important;position:relative;overflow:hidden;z-index:1">
  <div class="overpriced-inner w-full px-6 md:px-12 lg:px-24 xl:px-32 py-12 md:py-16 lg:py-24" style="background:transparent!important">
    <div class="q888-ticker sticky top-0 z-30 bg-[var(--bg-fog)]/92 backdrop-blur-md border-b border-[var(--line-soft)]/60 w-screen -ml-[calc(50vw-50%)] -mr-[calc(50vw-50%)] py-[0.6875rem] shadow-[0_2px_12px_rgba(0,0,0,0.08)]" style={`--ticker-font: ${tickerFont}`}>
      <div class="ticker-wrapper w-screen overflow-hidden">
        <div class="ticker-content flex">
          <span class="ticker-text font-[var(--ticker-font)] font-extralight text-base md:text-lg lg:text-xl tracking-[0.2em] uppercase text-[#a67c00] whitespace-nowrap flex-shrink-0 mr-8">{tickerText}</span>
          <span class="ticker-text font-[var(--ticker-font)] font-extralight text-base md:text-lg lg:text-xl tracking-[0.2em] uppercase text-[#a67c00] whitespace-nowrap flex-shrink-0 mr-8">{tickerText}</span>
          <span class="ticker-text font-[var(--ticker-font)] font-extralight text-base md:text-lg lg:text-xl tracking-[0.2em] uppercase text-[#a67c00] whitespace-nowrap flex-shrink-0 mr-8">{tickerText}</span>
          <span class="ticker-text font-[var(--ticker-font)] font-extralight text-base md:text-lg lg:text-xl tracking-[0.2em] uppercase text-[#a67c00] whitespace-nowrap flex-shrink-0 mr-8">{tickerText}</span>
        </div>
      </div>
    </div>

    <header class="hero mb-20 md:mb-24 lg:mb-32">
      <h1 class="text-6xl md:text-8xl lg:text-9xl xl:text-[10rem] font-bold mb-8 md:mb-12 leading-none tracking-tight">Overpriced Stickers</h1>
      <p class="text-2xl md:text-3xl lg:text-4xl font-medium mb-12 md:mb-16 leading-tight max-w-3xl text-left">Collect what doesn't make sense ‚Äî until it does.</p>
      <div class="max-w-4xl ml-auto text-left text-lg md:text-xl lg:text-2xl text-[var(--text-ink)] mb-16 md:mb-20 leading-relaxed space-y-6">
        <p>Overpriced Stickers are limited-edition art objects disguised as stickers. They exist at the fragile intersection of speculative value and quiet refusal‚Äîsomewhere between collectible, signal, and artifact.</p>
        <p>Each piece is verified, numbered, and released in fixed editions. Not to manufacture scarcity, but to draw clear boundaries around the system itself.</p>
        <p>There is no cart. No checkout. The exchange operates through invitation and negotiation. You signal intent. A channel may open.</p>
        <p>Value is never promised or defended. It emerges gradually through participation, belief, and the slow accumulation of meaning. These objects may appreciate. They may remain precisely as they are. Both outcomes are equally valid and approved by Square Bubbles Council‚Ñ¢ in this universe and another.</p>
      </div>
    </header>

    <div class="instruments-grid grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-6 md:gap-8 lg:gap-12 mb-20 md:mb-24">
      {instruments.map((instrument) => (
        <article class="instrument-card border border-[var(--line-soft)] bg-transparent hover:bg-[var(--bg-fog)]/80 overflow-hidden flex flex-col" data-instrument-id={instrument.id}>
          <div class="instrument-card-top flex justify-between items-baseline font-mono text-sm md:text-base lg:text-lg uppercase tracking-widest text-[#a67c00] px-4 pt-3">
            <span>{instrument.ticker}</span>
            <span>ED: {instrument.availableCount}/{instrument.editionTotal}</span>
          </div>
          <div class="instrument-card-body px-4 py-3 flex-1">
            <h2 class="font-bold text-[var(--text-ink)] text-xl md:text-2xl lg:text-3xl mb-1">{instrument.title}</h2>
            <p class="text-lg md:text-xl text-[var(--text-muted)] leading-snug">{instrument.tagline}</p>
          </div>
          <div class="instrument-meta font-mono text-xs md:text-sm uppercase tracking-wider text-[var(--text-muted)] px-4 py-3 border-t border-[var(--line-soft)] space-y-1">
            <div>PRICE: {instrument.ask} ¬∑ STATUS: {instrument.status}</div>
            <div>PROVENANCE: {instrument.provenance.split(" | ")[0]}</div>
            <div>QTY: {instrument.availableCount}/{instrument.editionTotal}</div>
          </div>
          <button
            type="button"
            class="instrument-frame block w-full aspect-[4/3] border-t border-[var(--line-soft)] bg-transparent hover:bg-[rgba(245,245,245,0.5)] transition-colors cursor-pointer focus:outline-none focus-visible:ring-1 focus-visible:ring-inset focus-visible:ring-[#a67c00]"
            data-drawer-trigger="sticker-detail"
            data-instrument-id={instrument.id}
            aria-label={`View details for ${instrument.title}`}
          ></button>
        </article>
      ))}
    </div>

    <footer class="return-policy prose prose-2xl md:prose-3xl lg:prose-4xl max-w-none leading-relaxed border-t border-[var(--line-soft)] pt-16 lg:pt-20 mt-24 text-lg md:text-xl text-[var(--text-ink)]">
      <h3 class="text-2xl md:text-3xl lg:text-4xl font-bold mb-6 not-italic">Return Policy</h3>
      <p>Overpriced Stickers are sold as collectible art objects. All sales are final. No returns, no refunds. By initiating a trade you confirm that you understand the speculative nature of the instrument and accept full responsibility for your participation. Provenance is verified at point of sale; transfer of ownership is recorded on-chain where applicable.</p>
      <div class="pt-8">
        <button type="button" data-portal-back class="panel-back hover:text-[#a67c00]">Retreat to Market</button>
      </div>
    </footer>
  </div>
</section>

<div id="sticker-detail-drawer" class="sticker-drawer-root" data-drawer="sticker" aria-hidden="true">
  <div data-drawer-panel="sticker-detail" data-current-instrument-id="" class="drawer-panel sticker-drawer-panel" data-direction="right" role="dialog" aria-modal="true" aria-label="Sticker instrument details">
    <div class="drawer-scroll">
      <header class="drawer-header">
        <button type="button" data-sticker-drawer-close class="drawer-back" aria-label="Close drawer">Back to Exchange</button>
      </header>
      <div class="drawer-content">
        <p class="drawer-ticker font-mono text-sm uppercase tracking-widest text-[#a67c00] mb-2" data-sticker-ticker></p>
        <h2 class="drawer-title text-2xl md:text-3xl font-bold text-[var(--text-ink)] mb-4" data-sticker-title></h2>
        <p class="drawer-tagline text-[var(--text-muted)] mb-6" data-sticker-tagline></p>
        <div class="drawer-meta flex flex-col gap-y-1 font-mono text-xs uppercase tracking-wider text-[var(--text-muted)] mb-6 pb-6 border-b border-[var(--line-soft)]" data-sticker-meta></div>
        <p class="drawer-protocol text-sm text-[var(--text-muted)] mb-6">Trade protocol: negotiation via email. No automated checkout. Signal intent; we respond.</p>
        <div data-sticker-negotiation>
          <button type="button" class="open-negotiation font-mono text-xs uppercase tracking-widest text-[#a67c00] hover:underline focus:outline-none focus-visible:ring-1 focus-visible:ring-[#a67c00] rounded px-2 py-1" data-sticker-negotiate-btn>Open negotiation channel</button>
          <p class="mt-2 text-sm text-[var(--text-muted)] hidden" data-sticker-email></p>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  /* INFOCIGAN INHERITANCE LOCK */
  .overpriced-stickers-outer,
  .overpriced-inner,
  .instrument-card,
  .instrument-frame {
    background: transparent !important;
  }

  /* TICKER FOG GLASS ONLY */
  .q888-ticker {
    background: rgba(245,245,245,0.92) !important;
  }

  /* GRID ON FOG */
  .overpriced-stickers-outer::before {
    content: "";
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(rgba(245,245,245,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(212,175,55,0.02) 1px, transparent 1px);
    background-size: 50px 50px;
    opacity: 0.03;
    pointer-events: none;
  }

  .ticker-wrapper {
    width: 100vw;
    overflow: hidden;
  }

  .ticker-content {
    display: flex;
    animation: q888-marquee 28s linear infinite;
  }

  .ticker-content:hover {
    animation-play-state: paused;
  }

  @keyframes q888-marquee {
    0% { transform: translateX(0); }
    100% { transform: translateX(-25%); }
  }

  @media (prefers-reduced-motion: reduce) {
    .ticker-content {
      animation: none;
    }
  }

  .ticker-text {
    font-weight: 200 !important;
    letter-spacing: 0.2em !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
  }

  @media (max-width: 768px) {
    .ticker-text {
      font-size: 0.875rem !important;
    }
  }

  .instrument-card {
    display: flex;
    flex-direction: column;
  }

  .instrument-frame {
    box-shadow: inset 0 0 0 1px var(--line-soft);
  }

  .sticker-drawer-root {
    position: fixed;
    inset: 0;
    z-index: 210;
    pointer-events: none;
  }

  .sticker-drawer-root[aria-hidden="false"] {
    pointer-events: auto;
  }

  .sticker-drawer-panel {
    position: absolute;
    inset: 0;
    left: auto;
    width: min(100%, 36rem);
    background: var(--bg-fog);
    opacity: 0;
    visibility: hidden;
    transform: translateX(100%);
    transition: opacity 0.3s ease, transform 0.35s ease;
  }

  .sticker-drawer-root[aria-hidden="false"] .sticker-drawer-panel.is-active {
    opacity: 1;
    visibility: visible;
    transform: translateX(0);
  }

  .sticker-drawer-root .drawer-scroll {
    height: 100%;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }

  .sticker-drawer-root .drawer-header {
    position: sticky;
    top: 0;
    z-index: 10;
    padding: 1.5rem clamp(1rem, 3vw, 2rem);
    background: var(--bg-fog);
    border-bottom: 1px solid var(--line-soft);
    display: flex;
    justify-content: flex-end;
  }

  .sticker-drawer-root .drawer-back {
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
    font-size: 0.75rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--text-muted);
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
  }

  .sticker-drawer-root .drawer-back:hover {
    color: var(--text-ink);
  }

  .sticker-drawer-root .drawer-content {
    max-width: 48rem;
    margin: 0 auto;
    padding: 2rem clamp(1rem, 3vw, 2rem) 4rem;
  }

  @media (prefers-reduced-motion: reduce) {
    .sticker-drawer-panel {
      transition: none;
    }
  }
</style>

<script define:vars={{ instruments }}>
  (function () {
    const root = document.getElementById("sticker-detail-drawer");
    const panel = root?.querySelector("[data-drawer-panel=\"sticker-detail\"]");
    const triggers = document.querySelectorAll("[data-drawer-trigger=\"sticker-detail\"]");
    const closeBtn = root?.querySelector("[data-sticker-drawer-close]");
    const tickerEl = root?.querySelector("[data-sticker-ticker]");
    const titleEl = root?.querySelector("[data-sticker-title]");
    const taglineEl = root?.querySelector("[data-sticker-tagline]");
    const metaEl = root?.querySelector("[data-sticker-meta]");
    const negotiateBtn = root?.querySelector("[data-sticker-negotiate-btn]");
    const emailEl = root?.querySelector("[data-sticker-email]");

    const data = Array.isArray(instruments) ? instruments : [];

    function openDrawer(id) {
      const inst = data.find((i) => i.id === id);
      if (!root || !panel || !inst) return;
      panel.setAttribute("data-current-instrument-id", id);
      if (tickerEl) tickerEl.textContent = inst.ticker;
      if (titleEl) titleEl.textContent = inst.title;
      if (taglineEl) taglineEl.textContent = inst.tagline;
      if (metaEl) {
        metaEl.innerHTML = `<div>PRICE: ${inst.ask} ¬∑ STATUS: ${inst.status}</div><div>PROVENANCE: ${inst.provenance}</div><div>QTY: ${inst.availableCount}/${inst.editionTotal}</div>`;
      }
      if (emailEl) {
        emailEl.textContent = "";
        emailEl.classList.add("hidden");
      }
      if (negotiateBtn) negotiateBtn.hidden = false;
      panel.classList.add("is-active");
      root.setAttribute("aria-hidden", "false");
    }

    function closeDrawer() {
      if (!root || !panel) return;
      panel.classList.remove("is-active");
      root.setAttribute("aria-hidden", "true");
    }

    function revealEmail() {
      const id = panel?.getAttribute("data-current-instrument-id");
      const inst = data.find((i) => i.id === id);
      if (!emailEl || !inst) return;
      emailEl.textContent = inst.contactEmail;
      emailEl.classList.remove("hidden");
      if (negotiateBtn) negotiateBtn.hidden = true;
    }

    triggers.forEach((el) => {
      el.addEventListener("click", () => {
        const id = el.getAttribute("data-instrument-id");
        if (id) openDrawer(id);
      });
    });
    closeBtn?.addEventListener("click", closeDrawer);
    negotiateBtn?.addEventListener("click", revealEmail);

    root?.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && root.getAttribute("aria-hidden") === "false") closeDrawer();
    });
  })();
</script>
