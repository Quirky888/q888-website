---
---

<div 
  id="project-drawer" 
  data-drawer 
  class="drawer-root"
  aria-hidden="true"
>
  <!-- Digital Ink Panel -->
  <div 
    data-drawer-panel="digital-ink" 
    data-direction="left"
    class="drawer-panel di-theme"
    role="dialog"
    aria-modal="true"
    aria-label="Digital Ink project details"
  >
    <div class="drawer-scroll">
      <header class="drawer-header">
        <button 
          data-drawer-close 
          class="drawer-back"
          aria-label="Close drawer and return to Projects"
        >
          Back to Projects
        </button>
      </header>
      
      <section class="di-panel di-body overflow-x-clip">
        <!-- Q888:SECTION_START id="di-header" -->
        <div class="px-6 sm:px-10 lg:px-16 pt-32 sm:pt-36 pb-16">
          <div class="mx-auto">
            <h1 class="di-headline uppercase font-medium tracking-[-0.045em] leading-[0.88] text-[clamp(4rem,9vw,10.5rem)] text-zinc-50">
              DIGITAL INK
            </h1>
            
            <p class="mt-8 mx-auto text-[clamp(1.9rem,3vw,3.4rem)] leading-[1.12] text-zinc-200">
              What if digital art had memory? What if every brushstroke carried weight, history, and emotional resonance? Digital Ink reimagines digital creation by introducing scarcity, symbolism, and intention into the drawing process—transforming pixels into living artifacts that remember their origins and evolve through your artistic journey.
            </p>

            <p class="mt-8 mx-auto text-[clamp(1.3rem,1.5vw,1.6rem)] leading-relaxed text-zinc-300">
              Digital Ink turns the smallest unit of digital creation into something with weight:
              <span class="text-zinc-100">one image → one Smart Ink Drop (1×1) </span>
            </p>

            <div class="di-mono mt-10 text-lg sm:text-xl text-zinc-400 leading-relaxed">
              <div>SYSTEM_STATUS: APPROVED · PLATFORM: iPadOS (iPad-only)</div>
              <div>STATUS: AVAILABLE TOMORROW</div>
              <div>ROLE: Concept · Product Design · UX · SwiftUI</div>
              <div>YEAR: 2025–2026</div>
            </div>
          </div>
        </div>
        <!-- Q888:SECTION_END id="di-header" -->

        <!-- IMAGE 1 -->
        <div class="full-bleed">
          <div class="aspect-video w-full bg-zinc-900/60">
            <img src="/images/DigitalInk_Ipad_kn.webp" alt="Digital Ink on iPad" class="h-full w-full object-cover" />
          </div>
        </div>

        <!-- Q888:SECTION_START id="di-philosophy" -->
        <div class="px-6 sm:px-10 lg:px-16 py-16">
          <div class="mx-auto">
            <h2 class="text-4xl sm:text-5xl font-medium tracking-[-0.015em] text-zinc-50">Philosophy & Experience</h2>
            <div class="mt-8 space-y-8 mx-auto text-2xl sm:text-3xl leading-[1.55] text-zinc-300">
              <p>
                Digital Ink challenges the disposable nature of infinite digital tools. In an age where we can undo endlessly and create without consequence, this app asks: what if your materials were finite and precious? Each of your 1,000 Smart Inks is extracted from personal images—photographs, memories, moments that matter to you. When you draw, you're not just arranging colors; you're weaving your personal history into visual form. Every pixel remembers when it was born, where it came from, and carries symbolic meaning through color-to-emotion mapping. This creates a profound shift: your tiny 100-pixel artwork holds deep sentimental value because each drop is irreplaceable and emotionally alive.​
              </p>
            </div>
          </div>
        </div>
        <!-- Q888:SECTION_END id="di-philosophy" -->

        <!-- IMAGE 2 -->
        <div class="full-bleed">
          <div class="di-reveal aspect-video w-full bg-transparent relative overflow-hidden" data-di-reveal="image2">
            <!-- Base (aligned right, not stretched) -->
            <img
              src="/images/screen.webp"
              alt="Digital Ink canvas (base)"
              class="absolute inset-y-0 right-0 h-[90%] w-auto top-1/2 -translate-y-1/2 object-contain z-10"
              loading="lazy"
              decoding="async"
            />

            <!-- Overlay (aligned right, not stretched) -->
            <img
              src="/images/screen_overlay.webp"
              alt="Digital Ink canvas (overlay)"
              class="di-reveal-overlay absolute inset-y-0 right-0 h-[90%] w-auto top-1/2 -translate-y-1/2 object-contain z-20"
              loading="lazy"
              decoding="async"
            />
          </div>
        </div>

        <!-- Q888:SECTION_START id="di-innovation" -->
        <div class="px-6 sm:px-10 lg:px-16 py-16">
          <div class="mx-auto">
            <h2 class="text-4xl sm:text-5xl font-medium tracking-[-0.015em] text-zinc-50">Innovation Beyond Traditional Drawing Apps</h2>
            <div class="mt-8 space-y-8 mx-auto text-2xl sm:text-3xl leading-[1.55] text-zinc-300">
              <p>
                Unlike Procreate, Adobe Fresco, or other drawing apps that offer unlimited brushes and infinite resources, Digital Ink introduces constraint-based creativity. The core innovation is the Symbolic Smart Pixel Protocol (SSPP): each ink carries dual identity as both data (SHA-256 hash, timestamp, provenance) and myth (essence, elemental frequency, emotional resonance). The AI-powered poetic transformation layer uses Apple Vision + GPT-4o to turn ordinary image descriptions into mystical narratives—"Tree" becomes "Ancient Earth Sentinel." This isn't just a drawing tool; it's a ritual space where scarcity drives intentionality, and every creative decision carries weight. The offline-first architecture with server-verified token system ensures your limited inks remain secure, tracked, and truly yours across their entire lifecycle.​
              </p>
            </div>
          </div>
        </div>
        <!-- Q888:SECTION_END id="di-innovation" -->

        <!-- IMAGE 3 -->
        <div class="full-bleed">
          <div class="di-reveal aspect-video w-full bg-transparent relative overflow-hidden" data-di-reveal="image3">
            <!-- Base image -->
            <img
              src="/images/memory.webp"
              alt="Digital Ink memory (base)"
              class="absolute inset-y-0 right-0 h-full w-auto object-contain z-10"
              loading="lazy"
              decoding="async"
            />

            <!-- Overlay image -->
            <img
              src="/images/memory_overlay.webp"
              alt="Digital Ink memory (overlay)"
              class="di-reveal-overlay absolute inset-y-0 right-0 h-full w-auto object-contain z-20"
              loading="lazy"
              decoding="async"
            />

            <!-- Fog quote text -->
            <div class="di-fog-text absolute right-6 sm:right-10 lg:right-16 top-1/2 -translate-y-1/2 z-15 text-left pointer-events-none">
              <p class="text-[clamp(2.2rem,5vw,5rem)] font-bold tracking-[-0.03em] leading-[1.1] text-zinc-200/40 blur-[1.5px]" style="font-family: 'Space Grotesk', sans-serif; text-shadow: 0 0 30px rgba(255,255,255,0.15);">
                I REMEMBER …<br/>being many pixels…
              </p>
            </div>
          </div>
        </div>

        <!-- Q888:SECTION_START id="di-details" -->
        <div class="px-6 sm:px-10 lg:px-16 py-16 pb-32">
          <div class="mx-auto">
            <div class="space-y-16">
              <div>
                <h2 class="text-4xl sm:text-5xl font-medium tracking-[-0.015em] text-zinc-50">Technical Architecture</h2>
              <p class="mt-8 mx-auto text-2xl sm:text-3xl leading-[1.55] text-zinc-300">
                Digital Ink is built on SwiftUI with Core Data persistence, implementing a three-state ink lifecycle architecture: InkHome (available pool), Canvas (actively placed in artwork), and Gallery (archived in completed pieces). The drawing engine leverages native iOS 18 gesture recognition to deliver Procreate-quality pan, zoom, and rotation interactions. A custom tap-to-place pixel system provides precise control while maintaining the fluidity expected from professional creative tools.​

              </p>
            </div>

            <div>
              <h2 class="text-4xl sm:text-5xl font-medium tracking-[-0.015em] text-zinc-50">AI & Vision Integrationt</h2>
              <div class="mt-8 space-y-8 mx-auto text-2xl sm:text-3xl leading-[1.55] text-zinc-300">
                <p>
                  The app integrates Apple Vision framework for scene understanding and GPT-4o-mini for caption generation, creating a two-stage transformation pipeline. When users import images, Vision analyzes visual content, then GPT-4o applies a poetic transformation layer that generates mystical, emotionally resonant descriptions. A proprietary color-to-frequency mapping algorithm assigns elemental values (Earth, Water, Fire, Air, Love, Mushroom) based on hue, saturation, and contextual analysis.​
                </p>
                
              </div>
            </div>
            <div class="space-y-16">

              <!-- Data Integrity & Security -->
              <div>
                <h2 class="text-4xl sm:text-5xl font-medium tracking-[-0.015em] text-zinc-50">
                  Data Integrity &amp; Security
                </h2>
            
                <div class="mt-8 space-y-8 mx-auto text-2xl sm:text-3xl leading-[1.55] text-zinc-300">
                  <p>
                    To enforce the one-image–one-pixel constraint, Digital Ink implements SHA-256 hashing for duplicate detection.
                    The token-based economy uses StoreKit 2 with a Cloudflare Durable Objects backend for server-side purchase verification
                    and audit-grade logging. This architecture ensures that every Smart Ink is provably unique, traceable, and secure—creating
                    genuine digital scarcity without blockchain overhead.
                  </p>
                </div>
              </div>
            
              <!-- Technical Stack -->
              <div>
                <h2 class="text-4xl sm:text-5xl font-medium tracking-[-0.015em] text-zinc-50">
                  Technical Stack
                </h2>
            
                <div class="mt-8 mx-auto text-2xl sm:text-3xl leading-[1.55] text-zinc-300">
                  <ul class="space-y-3">
                    <li><span class="text-zinc-200">Frontend:</span> Swift, SwiftUI, Core Data</li>
                    <li><span class="text-zinc-200">AI/ML:</span> Apple Vision Framework, GPT-4o-mini API</li>
                    <li><span class="text-zinc-200">Backend:</span> Cloudflare Durable Objects, StoreKit 2</li>
                    <li><span class="text-zinc-200">Platform:</span> iPadOS (native iPad app)</li>
                  </ul>
                </div>
              </div>
            
              <!-- Development Journey -->
              <div>
                <h2 class="text-4xl sm:text-5xl font-medium tracking-[-0.015em] text-zinc-50">
                  Development Journey
                </h2>
            
                <div class="mt-8 space-y-8 mx-auto text-2xl sm:text-3xl leading-[1.55] text-zinc-300">
                  <p>
                    As solo developer and designer, I architected every aspect of Digital Ink—from philosophical concept to production deployment.
                    The gesture system required deep study of iOS touch handling to match the polish users expect from tools like Procreate.
                    Implementing server-verified purchases demanded careful security architecture to prevent token fraud while maintaining smooth
                    user experience. The AI integration pipeline needed optimization to balance poetic output quality with performance constraints
                    on-device.
                  </p>
            
                  <p>
                    The project launched successfully on the App Store on January 12, 2026, delivering the complete MVP feature set:
                    drawing engine, import system, metadata tracking, in-app purchases, and gallery functionality.
                  </p>
                </div>
              </div>
            
              <!-- Artistic & Cultural Implications -->
              <div>
                <h2 class="text-4xl sm:text-5xl font-medium tracking-[-0.015em] text-zinc-50">
                  Artistic &amp; Cultural Implications
                </h2>
            
                <div class="mt-8 space-y-8 mx-auto text-2xl sm:text-3xl leading-[1.55] text-zinc-300">
                  <p>
                    Digital Ink proposes a new form of pixel-based authorship where art becomes a system of resonance and memory, not just visual beauty.
                    Ownership of ink drops ties directly to emotional experiences—imported dream images, meaningful photographs, AI-generated collaborations.
                    Each drawing becomes ritual rather than routine, transforming digital matter with conscious intent. This opens possibilities for symbolic
                    storytelling where the meaning behind each pixel matters as much as its color.
                  </p>
                </div>
              </div>
            
              <!-- Future Development Roadmap -->
              <div>
                <h2 class="text-4xl sm:text-5xl font-medium tracking-[-0.015em] text-zinc-50">
                  Future Development Roadmap
                </h2>
            
                <div class="mt-8 space-y-10 mx-auto text-2xl sm:text-3xl leading-[1.55] text-zinc-300">
                  <p>
                    Digital Ink is designed as a platform for expansion into new creative territories:
                  </p>
            
                  <div class="space-y-10">
                    <div>
                      <h3 class="text-xl sm:text-2xl font-medium text-zinc-100 tracking-[-0.01em] uppercase">
                        Cloud Sync &amp; Cross-Device Tracking
                      </h3>
                      <p class="mt-4">
                        Long-term ink history synchronized across devices, allowing artists to see how their ink pools evolve over months and years.
                      </p>
                    </div>
            
                    <div>
                      <h3 class="text-xl sm:text-2xl font-medium text-zinc-100 tracking-[-0.01em] uppercase">
                        Ink Biographies
                      </h3>
                      <p class="mt-4">
                        Detailed timeline views showing how individual pixels traveled through multiple artworks, creating visual genealogies of creative decisions.
                      </p>
                    </div>
            
                    <div>
                      <h3 class="text-xl sm:text-2xl font-medium text-zinc-100 tracking-[-0.01em] uppercase">
                        AI Memory Reconstruction
                      </h3>
                      <p class="mt-4">
                        Smart Inks that speak through AI-powered image reconstruction. Using original image descriptions, metadata, and accumulated usage history,
                        the system generates new artworks from your digital ink memories—transforming your creative archive into a generative storytelling engine.
                      </p>
                    </div>
            
                    <div>
                      <h3 class="text-xl sm:text-2xl font-medium text-zinc-100 tracking-[-0.01em] uppercase">
                        Collaborative Features
                      </h3>
                      <p class="mt-4">
                        Shared ink pools for co-creation, ink trading between artists, and community-driven symbolic protocols.
                        This opens possibilities for collaborative storytelling where multiple artists contribute to shared mythologies.
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            
              <!-- Physical-Digital Hybrid: Sticker & Skin System -->
              <div>
                <h2 class="text-4xl sm:text-5xl font-medium tracking-[-0.015em] text-zinc-50">
                  Physical-Digital Hybrid: Sticker &amp; Skin System
                </h2>
            
                <div class="mt-8 space-y-8 mx-auto text-2xl sm:text-3xl leading-[1.55] text-zinc-300">
                  <p>
                    Digital Ink bridges physical and digital realms through limited-edition collectible stickers that unlock app enhancements.
                    Each physical sticker purchase includes a unique digital patch code, creating tangible connection between physical art objects
                    and digital creative tools.
                  </p>
                </div>
              </div>
            
              <!-- Aura Sticker System -->
              <div>
                <h2 class="text-4xl sm:text-5xl font-medium tracking-[-0.015em] text-zinc-50">
                  Aura Sticker System
                </h2>
            
                <div class="mt-8 space-y-8 mx-auto text-2xl sm:text-3xl leading-[1.55] text-zinc-300">
                  <p>
                    Each sticker functions as a digital artifact carrying specific aura properties that enhance app functionality:
                  </p>
            
                  <ul class="space-y-3">
                    <li>Expands ink capacity</li>
                    <li class="text-zinc-200">
                      Example: “Overpriced Knight” sticker grants +8.88% ink on top of allowed 1000 Smart Inks
                    </li>
                  </ul>
            
                  <p>
                    This system transforms stickers from passive collectibles into functional upgrades while maintaining the core philosophy of meaningful constraints.
                    Limited physical production ensures genuine scarcity, and each sticker’s aura is carefully balanced to enhance—not overwhelm—the intentional
                    creative experience.
                  </p>
                </div>
              </div>
            
              <!-- Premium Cosmetic System: Luxurious Lux -->
              <div>
                <h2 class="text-4xl sm:text-5xl font-medium tracking-[-0.015em] text-zinc-50">
                  Premium Cosmetic System: Luxurious Lux
                </h2>
            
                <div class="mt-8 space-y-8 mx-auto text-2xl sm:text-3xl leading-[1.55] text-zinc-300">
                  <p>
                    For collectors seeking pure aesthetic prestige, Digital Ink offers premium cosmetic upgrades that provide zero gameplay advantage
                    but maximum visual impact.
                  </p>
            
                  <div>
                    <h3 class="text-xl sm:text-2xl font-medium text-zinc-100 tracking-[-0.01em] uppercase">
                      Luxurious Lux Skin features include
                    </h3>
            
                    <ul class="mt-4 space-y-3">
                      <li>Full golden/pearlescent UI transformation with subtle shimmer animations</li>
                      <li>Exclusive loading sequences with custom messaging</li>
                      <li>Canvas edge glow effects and refined visual flourishes</li>
                      <li>Premium audio feedback for interactions</li>
                    </ul>
                  </div>
            
                  <p>
                    This approach mirrors successful cosmetic systems in gaming and creative software, where optional prestige items support ongoing development
                    while preserving core functionality for all users. The premium tier exists purely for those who value aesthetic customization and want to
                    support continued platform development.
                  </p>
                </div>
              </div>
            
              <!-- Collectible Strategy -->
              <div>
                <h2 class="text-4xl sm:text-5xl font-medium tracking-[-0.015em] text-zinc-50">
                  Collectible Strategy
                </h2>
            
                <div class="mt-8 space-y-8 mx-auto text-2xl sm:text-3xl leading-[1.55] text-zinc-300">
                  <p>
                    The physical-digital hybrid model serves multiple purposes:
                  </p>
            
                  <ul class="space-y-3">
                    <li>Revenue diversification beyond app purchases alone</li>
                    <li>Community building through limited-edition releases and trading culture</li>
                    <li>Tangible brand presence in physical spaces (studios, desks, sketchbooks)</li>
                    <li>Graduated value tiers from functional aura stickers to pure prestige items</li>
                  </ul>
            
                  <p>
                    Each physical sticker is produced in numbered limited editions, with digital codes redeemable once per purchase.
                    This creates legitimate scarcity while preventing digital duplication, maintaining the app’s core philosophy of meaningful constraints.
                  </p>
                </div>
              </div>
            
            </div>
            </div>
          </div>
        </div>
        <!-- Q888:SECTION_END id="di-details" -->

        <!-- FOOTER BANNER -->
        <div class="full-bleed mt-24 pb-32 flex justify-center">
          <a 
            href="https://apps.apple.com/us/app/digital-ink/id6757157376" 
            target="_blank" 
            rel="noopener noreferrer"
            class="di-app-banner block w-[95%] mx-auto outline-none"
          >
            <img 
              src="/images/digitalink_appstore.png" 
              alt="Download Digital Ink on the App Store" 
              class="w-full h-auto object-cover"
            />
          </a>
        </div>
      </section>
    </div>
  </div>

  <!-- Edinburgh Magical Map Panel -->
  <div 
    data-drawer-panel="edinburgh-map" 
    data-direction="right"
    class="drawer-panel eden-panel"
    role="dialog"
    aria-modal="true"
    aria-label="Edinburgh Magical Map project details"
    data-eden-map-section
  >
    <div class="drawer-scroll">
      <header class="drawer-header">
        <button 
          data-drawer-close 
          class="drawer-back"
          aria-label="Close drawer and return to Projects"
        >
          Back to Projects
        </button>
      </header>

      <!-- Q888:SECTION_START id="eden-hero" -->
      <section class="eden-hero-section px-6 sm:px-10 lg:px-16 pt-32 sm:pt-36 pb-16">
        <div class="mx-auto">
          <h1 class="eden-headline uppercase font-medium tracking-[-0.045em] leading-[0.88] text-[clamp(4rem,9vw,10.5rem)] text-black">
            EDINBURGH MAGICAL MAP
          </h1>
          
          <div class="mt-12 mx-auto text-[clamp(1.6rem,2.8vw,3rem)] leading-[1.15] text-black">
            <p>
              Once upon a volcanic accident, before humans invented toasters or taxes, this corner of the world was a playground for wandering castles, invisible tradesmen, and time-displaced mushrooms. The locals — mostly <span class="censored" data-reveal="wraiths" tabindex="0">████</span> and politely carnivorous <span class="censored" data-reveal="cats" tabindex="0">███</span> — called it a quiet place, though nothing about it stayed quiet for long.
            </p>
            
            <p class="mt-8">
              Each bump on the map hides a <span class="censored" data-reveal="mildly" tabindex="0">████</span> cursed story, best discovered accidentally. Some doors won’t open unless you <span class="censored" data-reveal="kneel" tabindex="0">████</span> and <span class="censored" data-reveal="hum" tabindex="0">████</span>. Others demand riddles, bribes, or interpretive dance. If you’re lucky, they’ll ignore you entirely.
            </p>

            <p class="mt-8">
              Welcome to Edinburgh — where magic retired but still drinks in public.
            </p>
            
            <p class="mt-8 text-[clamp(1rem,1.2vw,1.3rem)] opacity-50">
              This description has been partially redacted under the Real Edinburgh Council Act No. 9093<span class="censored" data-reveal="???" data-eden-act-glitch tabindex="0">███</span>
            </p>
          </div>

          <div class="eden-mono mt-12 text-lg sm:text-xl text-zinc-500 leading-relaxed uppercase tracking-widest">
            <div>SYSTEM_STATUS: ACTIVE (REDACTED)</div>
            <div>LAYER: EDINBURGH CITY / UNDERWORLD OVERLAY</div>
            <div>ACCESS: COUNCIL-GATED</div>
            <div>YEAR: <span class="censored" data-reveal="??" data-eden-year-glitch tabindex="0">██</span>26 BBB</div>
          </div>
        </div>
      </section>
      <!-- Q888:SECTION_END id="eden-hero" -->

      <div class="eden-map-shell" data-eden-map>
        <div class="eden-map-inner" data-eden-map-inner>
          <img
            src="/images/Edinburgh_Magic.webp"
            alt="Edinburgh Magic map"
            class="eden-map-image"
            loading="lazy"
            decoding="async"
          />
          <svg
            class="eden-map-overlay"
            viewBox="0 0 9603 9481"
            role="img"
            aria-label="Edinburgh Magic map hotspots"
            data-eden-map-svg
          >
            <defs>
              <filter id="eden-glow-bright" x="-150%" y="-150%" width="400%" height="400%">
                <feGaussianBlur in="SourceAlpha" stdDeviation="12" result="blur1" />
                <feGaussianBlur in="blur1" stdDeviation="24" result="blur2" />
                <feGaussianBlur in="blur2" stdDeviation="36" result="blur3" />
                <feColorMatrix
                  in="blur3"
                  type="matrix"
                  values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 1 0"
                />
                <feMerge>
                  <feMergeNode in="blur3" />
                  <feMergeNode in="blur2" />
                  <feMergeNode in="blur1" />
                  <feMergeNode in="SourceGraphic" />
                </feMerge>
              </filter>
            </defs>
          </svg>
        </div>
      </div>

      <!-- Q888:FOOTER_START id="eden-footer" -->
      <footer class="eden-footer">
        <div class="eden-footer-container px-6 sm:px-10 lg:px-16">
          <div class="mx-auto w-full">
            <h2 class="eden-footer-headline uppercase font-medium tracking-[-0.035em] leading-[0.9] text-white">
              How to Navigate the Unspeakable
            </h2>
            
            <div class="eden-footer-body mt-10 space-y-8 text-white/85 max-w-[100ch]">
              <p>
                Click on the map — if it blinks, breathes, or glows suspiciously, it’s probably a location. Each spot hides a mildly censored, questionably accurate, and dangerously close-to-the-truth tale about Edinburgh’s forgotten past and unspoken present. Hidden histories, local myths, and ongoing mischief — all carefully buried just beneath polite reality.
              </p>
              
              <p class="pt-4">
                Try to find them before they find you.
              </p>
            </div>
          </div>
        </div>
      </footer>
      <!-- Q888:FOOTER_END id="eden-footer" -->
    </div>

    <div class="eden-story-drawer" data-eden-drawer aria-hidden="true">
      <div class="eden-drawer-inner">
        <header class="eden-drawer-header">
          <div class="eden-header-brand">
            <span class="eden-drawer-emoji" data-eden-emoji aria-hidden="true"></span>
            <h2 class="eden-drawer-title" data-eden-title>Edinburgh Magic</h2>
          </div>
          <button class="eden-drawer-close" type="button" data-eden-close aria-label="Close story">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <path d="M18 6L6 18M6 6l12 12"></path>
            </svg>
          </button>
        </header>

        <div class="eden-drawer-content">
          <div class="eden-accent-border" data-eden-accent aria-hidden="true" style="display: none;"></div>
          <div class="eden-content-container">
            <div class="eden-story-short">
              <div class="eden-story-heading">Summary</div>
              <p class="eden-story-short-text" data-eden-short>Select a location to begin.</p>
            </div>

            <div class="eden-story-long">
              <div class="eden-story-heading">History & Lore</div>
              <div class="eden-story-long-text" data-eden-long></div>
            </div>
          </div>
        </div>

        <footer class="eden-drawer-footer">
          <div class="eden-nav-dots" data-eden-dots aria-label="Story navigation"></div>
        </footer>
      </div>
    </div>
  </div>
</div>

<style>
  .drawer-root {
    position: fixed;
    inset: 0;
    z-index: 200;
    pointer-events: none;
  }

  .drawer-root[aria-hidden="false"] {
    pointer-events: auto;
  }

  .drawer-panel {
    position: absolute;
    inset: 0;
    background: var(--bg-fog);
    opacity: 0;
    visibility: hidden;
  }

  .drawer-panel.is-active {
    opacity: 1;
    visibility: visible;
  }

  .drawer-scroll {
    height: 100%;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }

  .drawer-header {
    position: sticky;
    top: 0;
    z-index: 100;
    padding: 1.5rem 2rem;
    background: var(--bg-fog);
    border-bottom: 1px solid var(--line-soft);
    display: flex;
    justify-content: flex-end;
  }

  @media (min-width: 768px) {
    .drawer-header {
      padding: 2rem 4rem;
    }
  }

  .drawer-back {
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
    font-size: 0.75rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--text-muted);
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
  }

  .drawer-back:hover {
    color: var(--text-ink);
  }

  .drawer-content {
    max-width: 48rem;
    margin: 0 auto;
    padding: 3rem 2rem 6rem;
  }

  @media (min-width: 768px) {
    .drawer-content {
      padding: 4rem 4rem 8rem;
    }
  }

  .drawer-title {
    font-size: clamp(2rem, 6vw, 3.5rem);
    font-weight: 400;
    color: var(--text-ink);
    margin-bottom: 1.5rem;
    letter-spacing: -0.02em;
  }

  .drawer-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem 2rem;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
    font-size: 0.625rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--text-muted);
    margin-bottom: 4rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid var(--line-soft);
  }

  .drawer-section {
    margin-bottom: 3rem;
  }

  .drawer-section-title {
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
    font-size: 0.7rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--text-muted);
    margin-bottom: 1rem;
  }

  .drawer-text {
    font-size: 1rem;
    line-height: 1.8;
    color: var(--text-ink);
    max-width: 40ch;
  }

  @media (min-width: 768px) {
    .drawer-text {
      font-size: 1.125rem;
    }
  }

  .drawer-placeholder {
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
    font-size: 0.625rem;
    letter-spacing: 0.3em;
    text-transform: uppercase;
    color: var(--text-muted);
    opacity: 0.3;
    padding: 4rem 2rem;
    border: 1px dashed var(--line-soft);
    text-align: center;
  }

  /* Scoped Theme for Digital Ink */
  .drawer-panel.di-theme {
    background: #28282B;
  }
  .drawer-panel.di-theme .drawer-header,
  .drawer-panel.di-theme .drawer-scroll {
    background: #28282B;
  }
  .drawer-panel.di-theme .drawer-header {
    border-bottom-color: rgba(255, 255, 255, 0.08);
  }
  .drawer-panel.di-theme .drawer-back:hover {
    color: #fff;
  }

  .di-panel { overflow-x: clip; background: #28282B; }

  .di-panel .di-headline {
    font-family: ui-sans-serif, system-ui, -apple-system, "SF Pro Display", "SF Pro Text", "Helvetica Neue", Arial, sans-serif;
  }
  .di-panel.di-body, .di-panel .di-body {
    font-family: ui-sans-serif, system-ui, -apple-system, "SF Pro Text", "SF Pro Display", "Helvetica Neue", Arial, sans-serif;
  }
  .di-panel .di-mono {
    font-family: ui-monospace, "SF Mono", Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  }

  /* Local Full-Bleed Utility */
  .di-panel .full-bleed {
    width: 100vw;
    position: relative;
    left: 50%;
    right: 50%;
    margin-left: -50vw;
    margin-right: -50vw;
    overflow: hidden;
  }

  .di-panel .di-reveal-overlay {
    transition:
      opacity 1200ms cubic-bezier(.4,0,.2,1),
      filter 1200ms cubic-bezier(.4,0,.2,1),
      transform 1200ms cubic-bezier(.4,0,.2,1);
    will-change: opacity, filter, transform;
    opacity: 0;
    filter: blur(4px);
    transform: scale(1.015);
    pointer-events: none;
  }

  .di-panel .di-reveal.is-active .di-reveal-overlay {
    opacity: 1;
    filter: blur(0px);
    transform: scale(1);
  }

  .di-panel .di-fog-text {
    font-family: ui-sans-serif, system-ui, -apple-system, "SF Pro Display", "SF Pro Text", "Helvetica Neue", Arial, sans-serif;
    transition:
      opacity 1000ms cubic-bezier(.4,0,.2,1),
      filter 1000ms cubic-bezier(.4,0,.2,1);
    will-change: opacity, filter;
  }

  .di-panel .di-reveal.is-active .di-fog-text {
    opacity: 0;
    filter: blur(8px);
  }

  .di-panel .di-app-banner {
    transition: filter 400ms ease;
  }

  .di-panel .di-app-banner:hover {
    filter: brightness(1.1);
  }

  .di-panel .di-app-banner:focus-visible {
    outline: 1px solid rgba(255, 255, 255, 0.3);
    outline-offset: -1px;
  }

  .di-panel .di-app-banner img {
    display: block;
  }

  /* Edinburgh Map Panel */
  .eden-panel {
    --eden-primary: #208c8d;
    --eden-primary-hover: #247480;
    --eden-primary-active: #134252;
    --eden-bg: #fcf8f9;
    --eden-surface: #ffffdd;
    --eden-text: #134252;
    --eden-text-muted: #627078;
    --eden-error: #c0152f;
    --eden-ease: cubic-bezier(0.16, 1, 0.3, 1);
    --eden-drawer-duration: 350ms;
    --eden-drawer-height-desktop: 45vh;
    --eden-drawer-height-tablet: 50vh;
    --eden-drawer-height-mobile: 100vh;
    --eden-ring-opacity: 0.18;
    background: var(--eden-bg);
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .eden-back-header {
    position: absolute;
    top: 0;
    right: 0;
    z-index: 180;
    padding: 1.5rem 2rem;
  }

  @media (min-width: 768px) {
    .eden-back-header {
      padding: 2rem 4rem;
    }
  }

  .eden-panel .drawer-back {
    color: var(--eden-text-muted);
    background: rgba(252, 248, 249, 0.85);
    padding: 0.5rem 1rem;
    border-radius: 4px;
  }

  .eden-panel .drawer-back:hover {
    color: var(--eden-text);
    background: rgba(252, 248, 249, 0.95);
  }

  /* Edinburgh Hero Styling */
  .eden-hero-section {
    background: var(--eden-bg);
  }

  .eden-headline {
    font-family: ui-sans-serif, system-ui, -apple-system, "SF Pro Display", "SF Pro Text", "Helvetica Neue", Arial, sans-serif;
  }

  .eden-hero-section p {
    font-family: ui-sans-serif, system-ui, -apple-system, "SF Pro Text", "SF Pro Display", "Helvetica Neue", Arial, sans-serif;
  }

  .eden-mono {
    font-family: ui-monospace, "SF Mono", Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  }

  /* Censorship Reveal Mechanism */
  .censored {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    position: relative;
    cursor: help;
    transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    background: black;
    color: transparent;
    border-radius: 2px;
    padding: 0 0.4em;
    margin: 0 0.15em; /* Prevent text overlap/clumping */
    user-select: none;
    font-family: ui-monospace, monospace;
    line-height: 1.2;
    min-width: 2em;
    height: 1.2em;
    vertical-align: middle;
  }

  /* The Black "Blocker" */
  .censored::before {
    content: "";
    position: absolute;
    inset: 0;
    background: black;
    opacity: 1;
    transition: opacity 0.3s ease;
    z-index: 2;
  }

  /* The "CENSORED" status text */
  .censored::after {
    content: "CENSORED";
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    color: white;
    /* Aggressive industrial font stack */
    font-family: "Impact", "Arial Black", "Arial Narrow", sans-serif;
    font-weight: 900;
    font-size: 0.42em; 
    letter-spacing: 0.18em;
    text-transform: uppercase;
    transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    z-index: 3;
    white-space: nowrap;
    text-shadow: 0 0 2px rgba(255, 255, 255, 0.3);
  }

  .censored:hover::before,
  .censored:focus-visible::before {
    opacity: 0.9; /* Keep a faint black background behind the white text */
  }

  .censored:hover::after,
  .censored:focus-visible::after {
    opacity: 1;
  }

  /* Special Case: YEAR Glitch uses data-reveal content */
  .censored[data-eden-year-glitch]::after {
    content: attr(data-reveal);
    font-size: 1em;
    letter-spacing: 0;
    filter: blur(8px);
  }

  .censored[data-eden-year-glitch]:hover::before,
  .censored[data-eden-year-glitch]:focus-visible::before {
    opacity: 0;
  }

  .censored[data-eden-year-glitch]:hover::after,
  .censored[data-eden-year-glitch]:focus-visible::after {
    filter: blur(0);
    text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
  }

  /* Hover-only glitching numbers (Year) */
  .censored[data-eden-year-glitch]::after {
    content: attr(data-reveal);
    opacity: 0;
    filter: blur(4px);
    color: white;
    font-family: ui-monospace, monospace;
    font-weight: 600;
    font-size: 1em;
    letter-spacing: 0;
    transition: all 0.3s ease;
  }

  .censored[data-eden-year-glitch]:hover::after,
  .censored[data-eden-year-glitch]:focus-visible::after {
    opacity: 1;
    filter: none;
  }

  .censored[data-eden-year-glitch]:hover::before,
  .censored[data-eden-year-glitch]:focus-visible::before {
    opacity: 0.9;
  }

  /* Hover-only glitching numbers (Act) */
  .censored[data-eden-act-glitch]::after {
    content: attr(data-reveal); /* Use the glitching numbers, not "CENSORED" */
    opacity: 0;
    filter: blur(4px);
    color: white;
    font-family: ui-monospace, monospace;
    font-weight: 600;
    font-size: 1em;
    letter-spacing: 0;
    transition: all 0.3s ease;
  }

  .censored[data-eden-act-glitch]:hover::after,
  .censored[data-eden-act-glitch]:focus-visible::after {
    opacity: 1;
    filter: none;
  }

  .censored[data-eden-act-glitch]:hover::before,
  .censored[data-eden-act-glitch]:focus-visible::before {
    opacity: 0.9;
  }

  .censored:focus-visible {
    outline: 1px solid rgba(0, 0, 0, 0.2);
    outline-offset: 2px;
  }

  .eden-map-shell {
    position: relative;
    width: 100%;
    height: 105vh; /* Increased from 85vh for more vertical presence */
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    background: var(--eden-bg);
  }

  .eden-map-inner {
    position: relative;
    width: 100%;
    height: 100%;
    max-width: 100%;
    max-height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    transform: scale(1.1); /* 10% zoom for a more immersive feel */
    transition: transform 0.6s var(--eden-ease);
  }

  .eden-map-image {
    width: 100%;
    height: 100%;
    object-fit: contain; /* Ensure image fits without distortion */
    display: block;
    pointer-events: none;
  }

  .eden-map-overlay {
    position: absolute;
    /* Match the contained image box exactly */
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100%;
    height: 100%;
    max-width: 100%;
    max-height: 100%;
    pointer-events: auto;
  }

  /* Edinburgh Footer Section */
  /* Explicitly confirming: no map CSS or selectors below this line were modified. */
  .eden-footer {
    width: 100%;
    background: #000;
    color: #fff;
    padding: 8rem 0;
    position: relative;
    z-index: 10;
  }

  .eden-footer-headline {
    font-family: ui-sans-serif, system-ui, -apple-system, "SF Pro Text", "SF Pro Display", "Helvetica Neue", Arial, sans-serif;
    font-size: clamp(1.8rem, 3.2vw, 3rem);
    text-align: left;
  }

  .eden-footer-body {
    font-family: ui-sans-serif, system-ui, -apple-system, "SF Pro Text", "SF Pro Display", "Helvetica Neue", Arial, sans-serif;
    font-size: clamp(1.4rem, 2.2vw, 2.2rem);
    line-height: 1.4;
  }

  @media (max-width: 768px) {
    .eden-footer {
      padding: 6rem 0;
    }
    .eden-footer-headline {
      font-size: 2.2rem;
    }
    .eden-footer-body {
      font-size: 1.25rem;
    }
  }

  .eden-hotspot {
    pointer-events: auto;
    cursor: pointer;
  }

  .eden-hotspot .hotspot-trigger {
    fill: transparent !important;
    stroke: none !important;
    pointer-events: all;
  }

  .eden-hotspot .hotspot-glow {
    fill-opacity: 0.03 !important;
    stroke: none !important;
    filter: blur(8px) !important;
    pointer-events: none;
    transition: all 700ms cubic-bezier(0.34, 1.56, 0.64, 1);
    transform-origin: center;
  }

  .eden-hotspot:hover .hotspot-glow,
  .eden-hotspot:focus-visible .hotspot-glow {
    fill-opacity: 0.75 !important;
    stroke: none !important;
    filter: blur(20px) drop-shadow(0 0 30px currentColor) drop-shadow(0 0 60px currentColor) !important;
    transform: scale(1.4);
    animation: magical-breathe 2.5s ease-in-out infinite !important;
  }

  @keyframes magical-breathe {
    0%,
    100% {
      fill-opacity: 0.65;
      transform: scale(1.3);
      filter: blur(18px) drop-shadow(0 0 25px currentColor) drop-shadow(0 0 50px currentColor);
    }
    50% {
      fill-opacity: 0.85;
      transform: scale(1.45);
      filter: blur(22px) drop-shadow(0 0 35px currentColor) drop-shadow(0 0 70px currentColor);
    }
  }

  .eden-hotspot:focus-visible {
    outline: none;
  }

  .eden-story-drawer {
    position: fixed;
    left: 0;
    right: 0;
    bottom: 0;
    height: 0;
    
    /* Modern Glass Card look */
    background: rgba(245, 245, 245, 0.82);
    -webkit-backdrop-filter: blur(16px);
    backdrop-filter: blur(16px);
    
    border-top: 1px solid rgba(0, 0, 0, 0.05);
    box-shadow: 
      0 -10px 40px rgba(0, 0, 0, 0.08),
      0 -1px 0 rgba(255, 255, 255, 0.4);
    
    border-top-left-radius: 28px;
    border-top-right-radius: 28px;
    
    overflow: hidden;
    transition: height var(--eden-drawer-duration) var(--eden-ease);
    z-index: 210;
    will-change: height;
  }

  .eden-story-drawer.is-open {
    height: var(--eden-drawer-height-desktop);
  }

  .eden-drawer-inner {
    display: flex;
    flex-direction: column;
    height: 100%;
    max-width: 1440px;
    margin: 0 auto;
  }

  .eden-accent-border {
    height: 4px;
    background: var(--eden-primary);
    flex-shrink: 0;
  }

  .eden-drawer-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 2.5rem 3rem 1.5rem;
    flex-shrink: 0;
  }

  .eden-header-brand {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .eden-drawer-emoji {
    display: none;
  }

  .eden-drawer-title {
    font-size: 2.25rem;
    font-weight: 500;
    color: var(--text-ink);
    letter-spacing: -0.03em;
    margin: 0;
    line-height: 1;
  }

  .eden-drawer-close {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 44px;
    height: 44px;
    border: none;
    background: rgba(0, 0, 0, 0.03);
    color: var(--text-muted);
    cursor: pointer;
    border-radius: 50%;
    transition: all 0.3s var(--eden-ease);
  }

  .eden-drawer-close:hover {
    background: rgba(0, 0, 0, 0.08);
    color: var(--text-ink);
    transform: rotate(90deg);
  }

  .eden-drawer-content {
    flex: 1;
    overflow-y: auto;
    padding: 0 3rem 4rem;
    scrollbar-width: thin;
    scrollbar-color: rgba(0,0,0,0.1) transparent;
  }

  /* Centered content container for desktop readability */
  .eden-content-container {
    max-width: 820px;
    margin: 0 auto;
  }

  .eden-story-heading {
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
    font-size: 0.65rem;
    font-weight: 500;
    text-transform: uppercase;
    color: var(--text-muted);
    letter-spacing: 0.2em;
    margin-bottom: 1.25rem;
    opacity: 0.6;
  }

  .eden-story-short-text {
    font-size: 1.5rem;
    font-weight: 400;
    line-height: 1.45;
    color: var(--text-ink);
    margin-bottom: 3rem;
  }

  .eden-story-long-text {
    font-size: 1.125rem;
    line-height: 1.8;
    color: var(--text-ink);
    opacity: 0.9;
  }

  .eden-story-long-text p {
    margin-bottom: 1.5rem;
  }

  .eden-drawer-footer {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1.5rem 3rem 2rem;
    flex-shrink: 0;
  }

  .eden-nav-dots {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .eden-nav-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: rgba(0, 0, 0, 0.1);
    cursor: pointer;
    transition: all 0.4s var(--eden-ease);
  }

  .eden-nav-dot.is-active {
    background: var(--text-ink);
    transform: scale(1.5);
  }

  @media (max-width: 1024px) {
    .eden-story-drawer.is-open {
      height: var(--eden-drawer-height-tablet);
    }
    
    .eden-drawer-header,
    .eden-drawer-content {
      padding-left: 2rem;
      padding-right: 2rem;
    }

    .eden-drawer-title {
      font-size: 1.75rem;
    }
  }

  @media (max-width: 768px) {
    .eden-story-drawer {
      border-top-left-radius: 22px;
      border-top-right-radius: 22px;
    }

    .eden-story-drawer.is-open {
      height: var(--eden-drawer-height-mobile);
    }

    .eden-drawer-header {
      padding: 1.5rem 1.5rem 1rem;
    }

    .eden-drawer-content {
      padding: 0 1.5rem 3rem;
    }

    .eden-story-short-text {
      font-size: 1.25rem;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .eden-hotspot,
    .eden-hotspot .hotspot-trigger,
    .eden-hotspot .hotspot-glow,
    .hotspot-ring-inner,
    .hotspot-ring-outer {
      transition: none !important;
      animation: none !important;
    }

    .eden-story-drawer {
      transition-duration: 0ms;
    }

    .eden-nav-dot {
      transition: none;
    }
  }
</style>

<style is:global>
  :root {
    --eden-smoke: rgba(190, 190, 190, 0.55);
    --magic-glow: #670074; 
  }

  .eden-hotspot {
    pointer-events: auto;
    cursor: pointer;
  }

  .eden-hotspot .hotspot-trigger {
    fill: transparent !important;
    stroke: none !important;
    pointer-events: all;
  }

  /* The Orbiting Rings */
  .hotspot-ring-inner,
  .hotspot-ring-outer {
    fill: none;
    stroke: var(--magic-glow);
    stroke-width: 1.5;
    opacity: 0;
    pointer-events: none;
    transform-origin: center;
    transform-box: fill-box;
    /* Transition opacity and width for a soft reveal */
    transition: 
      opacity 800ms ease, 
      stroke-width 800ms ease,
      stroke-dashoffset 800ms ease;
    filter: drop-shadow(0 0 5px var(--magic-glow));
  }

  .hotspot-ring-inner {
    stroke-dasharray: 4 8;
  }

  .hotspot-ring-outer {
    stroke-dasharray: 10 20;
    stroke-width: 0.8;
  }

  .eden-hotspot .hotspot-glow {
    fill: var(--eden-smoke) !important;
    fill-opacity: 0.25 !important;
    stroke: none !important;
    filter: blur(12px) !important;
    pointer-events: none;
    transition: all 700ms cubic-bezier(0.34, 1.56, 0.64, 1);
    transform-origin: center;
    transform-box: fill-box;
    animation-name: star-twinkle;
    animation-duration: var(--twinkle-dur, 3.6s);
    animation-delay: var(--twinkle-delay, 0s);
    animation-timing-function: ease-in-out;
    animation-iteration-count: infinite;
  }

  /* Hover State: Activate the Mechanism */
  .eden-hotspot:hover .hotspot-ring-inner,
  .eden-hotspot:focus-visible .hotspot-ring-inner {
    opacity: 0.8;
    stroke-width: 1.8;
    animation: ring-flow-forward 10s linear infinite;
  }

  .eden-hotspot:hover .hotspot-ring-outer,
  .eden-hotspot:focus-visible .hotspot-ring-outer {
    opacity: 0.5;
    stroke-width: 1.0;
    animation: ring-flow-backward 18s linear infinite;
  }

  .eden-hotspot:hover .hotspot-glow,
  .eden-hotspot:focus-visible .hotspot-glow {
    fill: var(--magic-glow) !important;
    fill-opacity: 0.2 !important; /* Soft circular glow inside */
    stroke: var(--magic-glow) !important;
    stroke-width: 28; /* Even thicker walls */
    stroke-opacity: 0.9 !important;
    filter: blur(2px) 
            drop-shadow(0 0 15px var(--magic-glow))
            drop-shadow(0 0 30px var(--magic-glow)) !important;
    transform: scale(1.1);
    animation: none !important; /* Stop twinkling on hover */
  }

  @keyframes ring-flow-forward {
    from { stroke-dashoffset: 60; }
    to { stroke-dashoffset: 0; }
  }

  @keyframes ring-flow-backward {
    from { stroke-dashoffset: 0; }
    to { stroke-dashoffset: 60; }
  }

  @keyframes star-twinkle {
    0%,
    100% {
      fill-opacity: calc(0.2 * var(--twinkle-strength, 1));
      transform: scale(0.92);
    }
    50% {
      fill-opacity: calc(0.45 * var(--twinkle-strength, 1));
      transform: scale(1.08);
    }
  }
</style>

<script>
  (() => {
    const panel = document.querySelector('[data-drawer-panel="digital-ink"]');
    if (!panel) return;

    const scrollContainer = panel.querySelector('.drawer-scroll');
    if (!scrollContainer) return;

    const image2 = panel.querySelector('[data-di-reveal="image2"]');
    const image3 = panel.querySelector('[data-di-reveal="image3"]');
    if (!image2 && !image3) return;

    let ticking = false;
    let lastScrollTop = 0;

    function checkReveal() {
      if (!scrollContainer) return;
      const containerRect = scrollContainer.getBoundingClientRect();
      const containerHeight = containerRect.height;
      if (containerHeight === 0) return;

      const currentScrollTop = scrollContainer.scrollTop;
      const scrollingDown = currentScrollTop > lastScrollTop;
      lastScrollTop = currentScrollTop;

      const containerCenter = containerRect.top + containerHeight / 2;
      const threshold = containerHeight * 0.15;

      // IMAGE 2: zone-based (on near center, off when away)
      if (image2) {
        const rect2 = image2.getBoundingClientRect();
        const center2 = rect2.top + rect2.height / 2;
        const dist2 = Math.abs(containerCenter - center2);

        if (dist2 < threshold) {
          image2.classList.add('is-active');
        } else {
          image2.classList.remove('is-active');
        }
      }

      // IMAGE 3: sticky downward (on near center, stays on when scrolling down, off when scrolling up)
      if (image3) {
        const rect3 = image3.getBoundingClientRect();
        const center3 = rect3.top + rect3.height / 2;
        const dist3 = Math.abs(containerCenter - center3);
        const isInZone = dist3 < threshold;

        if (isInZone) {
          if (!image3.classList.contains('is-active')) {
            image3.classList.add('is-active');
            console.log('[Digital Ink] IMAGE 3: ON');
          }
        } else if (!scrollingDown) {
          // Only deactivate when scrolling UP and out of zone
          if (image3.classList.contains('is-active')) {
            image3.classList.remove('is-active');
            console.log('[Digital Ink] IMAGE 3: OFF (scrolling up)');
          }
        }
      }

      ticking = false;
    }

    function onScroll() {
      if (!ticking) {
        requestAnimationFrame(checkReveal);
        ticking = true;
      }
    }

    scrollContainer.addEventListener('scroll', onScroll, { passive: true });
    window.addEventListener('resize', onScroll, { passive: true });
    window.addEventListener('orientationchange', onScroll, { passive: true });

    const observer = new MutationObserver(() => {
      if (panel.classList.contains('is-active')) {
        lastScrollTop = scrollContainer.scrollTop;
        checkReveal();
        setTimeout(checkReveal, 100);
      }
    });
    observer.observe(panel, { attributes: true, attributeFilter: ['class'] });
  })();

      // Edinburgh Number Glitch Logic
      (() => {
        const initGlitches = () => {
          const yearEl = document.querySelector('[data-eden-year-glitch]') as HTMLElement;
          const actEl = document.querySelector('[data-eden-act-glitch]') as HTMLElement;

          const updateNumbers = () => {
            if (yearEl) {
              yearEl.dataset.reveal = Math.floor(Math.random() * 100).toString().padStart(2, '0');
            }
            if (actEl) {
              actEl.dataset.reveal = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            }
          };

          // Update every 500ms (2 variations per second)
          setInterval(updateNumbers, 500);
          updateNumbers(); // Initial call
        };

        initGlitches();
        document.addEventListener('astro:page-load', initGlitches);
      })();

</script>